<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <title>5-Vagt | København</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }

    .legend, .filter-buttons {
      position: absolute;
      background: white;
      padding: 8px 12px;
      border-radius: 6px;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
      font-family: Arial, sans-serif;
      font-size: 14px;
      line-height: 1.5em;
    }

    .legend { bottom: 10px; left: 10px; z-index: 1001; }
    .legend span { display: inline-block; width: 12px; height: 12px; margin-right: 6px; border-radius: 50%; }

    .filter-buttons {
      top: 10px;
      right: 10px;
      z-index: 1000;
    }

    .filter-buttons button {
      display: block;
      margin: 4px 0;
      padding: 6px 10px;
      width: 130px;
      cursor: pointer;
      background-color: #ccc;
      border: none;
      border-radius: 4px;
      color: white;
      font-weight: bold;
      transition: background 0.2s;
    }

    .filter-buttons button.active {
      background-color: #28a745; /* grøn for aktiv */
    }

    .filter-buttons hr {
      margin: 8px 0;
      border: 0;
      border-top: 1px solid #999;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="filter-buttons">
    <button onclick="toggleRundering(0, this)">Indvendige</button>
    <button onclick="toggleRundering(1, this)">Udvendige</button>
    <button onclick="toggleRundering(2, this)">Beggedele</button>
    <hr>
    <button onclick="toggleBSection('5vagt1', this)">Aften</button>
    <button onclick="toggleBSection('5vagt2', this)">Natten</button>
    <button onclick="toggleBSection('5vagt3', this)">Morgen</button>
  </div>

  <div class="legend">
    <div><span style="background: blue"></span> 5vagt1 (Indvendig)</div>
    <div><span style="background: deepskyblue"></span> 5vagt1 (Udvendig)</div>
    <div><span style="background: dodgerblue"></span> 5vagt1 (Begge)</div>
    <div><span style="background: red"></span> 5vagt2 (Indvendig)</div>
    <div><span style="background: crimson"></span> 5vagt2 (Udvendig)</div>
    <div><span style="background: orangered"></span> 5vagt2 (Begge)</div>
    <div><span style="background: green"></span> 5vagt3 (Indvendig)</div>
    <div><span style="background: forestgreen"></span> 5vagt3 (Udvendig)</div>
    <div><span style="background: limegreen"></span> 5vagt3 (Begge)</div>
  </div>

  <script>
    // ==================== Kort setup ====================
    const map = L.map('map', {
      minZoom: 11,
      maxZoom: 17,
      maxBounds: [
        [55.55, 12.30],
        [55.78, 12.75]
      ],
      maxBoundsViscosity: 1.0
    }).setView([55.68, 12.54], 12);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);

    // ==================== Farver ====================
    const runderingFarver = {
      "5vagt1": {0: "blue", 1: "deepskyblue", 2: "dodgerblue"},
      "5vagt2": {0: "red", 1: "crimson", 2: "orangered"},
      "5vagt3": {0: "green", 1: "forestgreen", 2: "limegreen"}
    };

    // ==================== 5-vagt data ====================
	const vagterData = {
	  "5vagt1":[
		{ "adresse":"Glucksvej 2","koordinater":[55.64768361575623,12.534852916616735],"tid":"17:00","rundering":[1,0],"bemærkning":"Udvendig rundering" },
		{ "adresse":"Ørnevej 55","koordinater":[55.70194603352069,12.529290896995949],"tid":"Når det passer ind","rundering":[0,1],"bemærkning":"Brikker kun i stue: 6 på én side, 3 på anden. Indvendig hele huset" },
		{ "adresse":"Sundbyvestervej 97","koordinater":[55.645930822085866,12.601155594750571],"tid":"Når det passer ind","rundering":[2,0],"bemærkning":"Udvendig rundering. Yderdør + indvendig kun stueplan" },
		{ "adresse":"Jydeholmen 15","koordinater":[55.68553850761419,12.48925394943301],"tid":"18:30","rundering":[0,1],"bemærkning":"Kode 0028#. Indvendig rundering. 4. etage kode 223040. Brik + kode 2577. Elevator 2. etage" },
		{ "adresse":"Indertoften 10","koordinater":[55.686581085564164,12.489178877055254],"tid":"19:00","rundering":[0,1],"bemærkning":"Indvendig rundering. Reception alarmpanel kode 257700. B & D kælder. Opstart senest 20:00" },
		{ "adresse":"Fuglebakken, Borups Allé 177","koordinater":[55.696540351407265,12.5248094831904],"tid":"19:00–20:00","rundering":[0,1],"bemærkning":"Indvendig rundering – opstart senest 20:00. Kode 2300#." },
		{ "adresse":"Baldersgade 24","koordinater":[55.699577227641974,12.545536948088104],"tid":"Når det passer ind","rundering":[1,1],"bemærkning":"Udvendig rundering (yderdør)" },
		{ "adresse":"Lyongade 25, stuen, 2. sal og 3. sal","koordinater":[55.66179160957929,12.610266810552917],"tid":"21:00","rundering":[0,1],"bemærkning":"Indvendig rundering (ca. 20 min). Alarm tilkobles på 2. og 3. sal" },
		{ "adresse":"Njalsgade 171","koordinater":[55.66359599559324,12.591490226658513],"tid":"22:00","rundering":[2,0],"bemærkning":"Indvendig & udvendig rundering – husk tag og legeplads" },
		{ "adresse":"Amagerstrandvej 3","koordinater":[55.6698195391733,12.627007251779869],"tid":"Når det passer ind","rundering":[0,0],"bemærkning":"Indvendig rundering" },
		{ "adresse":"Nyrnberggade 23 (sleepcph)","koordinater":[55.66550362697973,12.618965541355816],"tid":"Når det passer ind","rundering":[2,0],"bemærkning":"Kun 2.-3. etage. Kode 257700 begge alarmpaneler. Udvendig tilsyn (5-10 min)" }
	  ],
	  "5vagt2":[],
	  "5vagt3":[]
	};


    // ==================== Opret markers ====================
    const bounds = L.latLngBounds();
    const markers = [];
    const bMarkers = { "5vagt1": [], "5vagt2": [], "5vagt3": [] };

    for (const [shift, locations] of Object.entries(vagterData)) {
      locations.forEach(loc => {
        const runderingType = loc.rundering[0];
        const markerColor = runderingFarver[shift][runderingType];

        const popupContent = `
          <b>${shift}</b><br>
          ${loc.adresse}<br>
          <b>Rundering:</b> ${runderingType}<br>
          <b>Tid:</b> ${loc.tid}<br>
          <b>Bemærkning:</b> ${loc.bemærkning || '-'}
        `;

        const marker = L.circleMarker(loc.koordinater, {
          color: markerColor,
          radius: 6,
          fillOpacity: 0.8,
          rundering: runderingType,
          visible: true
        }).addTo(map);

        marker.bindPopup(popupContent);
        marker.on('mouseover', function(){ this.openPopup(); });
        marker.on('mouseout', function(){ this.closePopup(); });

        markers.push(marker);
        bounds.extend(loc.koordinater);
        bMarkers[shift].push(marker);
      });
    }

    if (bounds.isValid()) map.fitBounds(bounds, { padding: [30,30] });

    // ==================== Toggle funktioner ====================
    let activeRundering = null;
    let activeBSection = null;

    function showAllMarkers() {
      markers.forEach(marker => {
        if (!marker.options.visible) {
          marker.addTo(map);
          marker.options.visible = true;
        }
      });
      activeRundering = null;
      activeBSection = null;
      document.querySelectorAll('.filter-buttons button').forEach(b => b.classList.remove('active'));
    }

    function toggleRundering(type, btn) {
      if (activeRundering === type) { showAllMarkers(); return; }

      document.querySelectorAll('.filter-buttons button').forEach(b => {
        if(b.onclick.toString().includes("toggleRundering")) b.classList.remove('active');
      });

      markers.forEach(marker => marker.remove());
      markers.forEach(marker => marker.options.visible = false);

      markers.forEach(marker => {
        if (marker.options.rundering === type) {
          marker.addTo(map);
          marker.options.visible = true;
        }
      });

      btn.classList.add('active');
      activeRundering = type;
      activeBSection = null;
    }

    function toggleBSection(section, btn) {
      if (activeBSection === section) { showAllMarkers(); return; }

      document.querySelectorAll('.filter-buttons button').forEach(b => {
        if(b.onclick.toString().includes("toggleBSection")) b.classList.remove('active');
      });

      Object.values(bMarkers).flat().forEach(marker => marker.remove());
      Object.values(bMarkers).flat().forEach(marker => marker.options.visible = false);

      bMarkers[section].forEach(marker => {
        marker.addTo(map);
        marker.options.visible = true;
      });

      btn.classList.add('active');
      activeBSection = section;
      activeRundering = null;
    }
  </script>
</body>
</html>
